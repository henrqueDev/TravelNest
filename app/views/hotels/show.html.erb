<div class="container justify-content-center align-items-center">
  

  <div class="row d-flex justify-content-center">
    <div class="col-lg-8 mt-3">
      <span>
        <h1>
          <%= link_to("", "javascript:history.back()", class:"bi bi-arrow-left btn btn-dark") %>
          <%= @hotel.title %>
        </h1>
      </span>
          <%= link_to("Adicionar Opção de Quarto", new_room_option_path(hotel_id: @hotel.id)) %>
        <%= render partial: 'hotel_details', locals: { hotel: @hotel } %>
        <%= form_with(url: hotel_reservations_path, method: "post", class:"") do |form| %>

          

          <div class="row border p-4 rounded-pill">
          
            <div class="col-md-6">
            <%= form.label :check_in %>
              <%= form.date_field :check_in, id:"check_in", class:"form-control" %>
            </div>
            
            <div class="col-md-6">
            <%= form.label :check_out %>
              <%= form.date_field :check_out, id:"check_out", class:"form-control"  %>
            </div> 

          </div>
          
          <div class="row mt-3">
            <%= form.label :room_option %>
            <%= form.select(:room_option_id, RoomOption.all.collect { |ro|  [ro.title, ro.id] },{},  id: "room_option_id", class:"form-select")  %> 
          </div>

          
          <div class="row mt-3">
            <%= form.hidden_field :user_id, value:  current_user.present? ? current_user.id : nil %>
            
            <div class="col-sm-5">
              <%= form.label :adults_quantity %>
              <%= form.number_field :adults_quantity, class:"mt-3 form-control" %>
            </div>

            <div class="col-sm-5">
              <%= form.label :children_quantity %>
              <%= form.number_field :children_quantity, class:"mt-3 form-control" %>
            </div>
          </div>
          

          <%= form.submit "Reservar ja!" %>
          <p id="price_per_day_banner"> </p>
        <% end %>

        <%= form_with url: "/payments/create", method: "post", class:"d-flex justify-content-end" do |form| %>
                  <%= form.hidden_field :qnt_cob, value: 0.01 %>
                  <%= form.hidden_field :id_user, value: current_user.present? ? current_user.id : nil %>
                  <%= form.hidden_field :id_hotel, value: @hotel.id %>
                  <%= form.submit "Enviar Pagamento", class:"btn btn-success" %>
        <% end %>
    </div>
  </div>
</div>


<script>

function fetchData(url, params, callback) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState === XMLHttpRequest.DONE) {
      if (xhr.status === 200) {
        var data = JSON.parse(xhr.responseText);
        callback(data);
      } else {
        console.error('Erro ao buscar dados:', xhr.status);
      }
    }
  };

  var queryString = Object.keys(params).map(key => key + '=' + params[key]).join('&');
  xhr.open('GET', url + '?' + queryString);
  xhr.send();
}


document.addEventListener('DOMContentLoaded', function() {
  //First load
  sala = document.getElementById("room_option_id")

  fetchData('/room_options/get_room_option', { id: sala.value }, function(room_option) {

      console.log(room_option)
      document.getElementById("price_per_day_banner").innerHTML = room_option.price_per_day
    })
  
  //After...
  document.getElementById("room_option_id").addEventListener("change", function(ro) {
    const selectedIndex = this.selectedIndex;
    const selectedOption = this.options[selectedIndex];
    
    fetchData('/room_options/get_room_option', { id: selectedOption.value }, function(room_option) {

      console.log(room_option)
      document.getElementById("price_per_day_banner").innerHTML = room_option.price_per_day
    })
  })

})
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script>
    // Disable specific dates (e.g., January 1, 2023)
    var disabledDates = ['2023-12-30', '2023-01-02'];
    
    var date_now = new Date();
    var tomorrow = date_now.getDate() + 1;


    $( function() {
      $( "#check_in" ).datepicker({
        dateFormat: 'yy-mm-dd',
        minDate: date_now.toISOString().slice(0, -14),
        beforeShowDay: function(date) {
          var formattedDate = $.datepicker.formatDate('yy-mm-dd', date);
          return [disabledDates.indexOf(formattedDate) === -1];
        },
        onSelect: function(dateText, inst) {
          if (disabledDates.includes(dateText)) {
            alert('This date is disabled.');
            $(this).val('');
            
          }
        }
      });
    });

    $( function() {
      $( "#check_out" ).datepicker({
        dateFormat: 'yy-mm-dd',
        minDate: date_now.toISOString().slice(0, -14),
        beforeShowDay: function(date) {
          var formattedDate = $.datepicker.formatDate('yy-mm-dd', date);
          return [disabledDates.indexOf(formattedDate) === -1];
        },
        onSelect: function(dateText, inst) {
          if (disabledDates.includes(dateText)) {
            alert('This date is disabled.');
            $(this).val('');
            
          }
        }
      });
    });
</script>
