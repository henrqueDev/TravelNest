<div class="container justify-content-center align-items-center">
  <div class="row d-flex justify-content-center">
    <div class="col-lg-2 mt-3 mr-5">


      <span>
        <h1>Filtro</h1>
      </span>
      <%= form_with(url: hotels_path, method: :get, class:"d-flex flex-md-column") do |form| %>
        <div class="mt-3">
          <p>Pais:</p>
          <%= form.select(:country_id, Country.all.collect { |c| [c.name, c.id] }, { include_blank: "Pais" }, class: "form-select mt-3", id: "country-select") %>
        </div>
        <div class="mt-3">
          <p>Estado:</p>
          <%= form.select(:state_id, [], { include_blank: "Estado" }, class: "form-select mt-3", id: "state-select") %>
        </div>
        <div class="mt-3">
          <p>Cidade:</p>
          <%= form.select(:city_id, [], { include_blank: "Cidade" }, class: "form-select mt-3", id: "city-select") %>
        </div>
        <div class="mt-3">
          <p>Avaliação:</p>

          <%= form.range_field(:evaluation, in: 0.0..10.0, step: 1, class: "form-range mt-3", id: "evaluation-range") %>
        </div>
        <%= form.submit "Buscar", name: nil, class:"btn btn-primary mt-5" %>
        <% end %>
        </div>
        <div class="col-lg-7 mt-3">
      <span>
        <h1>Hotels</h1>
      </span>
          <% @hotels.each_with_index do |hotel, idCard| %>
            <%= render(partial: 'hotel', locals: { hotel: hotel, idCard: idCard }) %>
          <% end %>
          <div role="navigation" aria-label="Pagination" class="apple_pagination">
            <div class="page_info">
              <%= will_paginate(@hotels) %>
            </div>
          </div>
        </div>
        </div>
        </div>



        <script>
            $(document).ready(function() {
                $("#country-select").on("change", function() {
                    var countryId = $(this).val();
                    var stateSelect = $("#state-select");
                    var citySelect = $("#city-select");
                    if (countryId == ''){
                        stateSelect.empty();
                        citySelect.empty();
                        stateSelect.append($("<option>", {
                            value: null,
                            text: null
                        }));

                        citySelect.append($("<option>", {
                            value: null,
                            text: null
                        }));
                        return;
                    }


                    $.get("/filter/get_states", { country_id: countryId }, function(data) {


                        stateSelect.empty();
                        citySelect.empty();

                        stateSelect.append($("<option>", {
                            value: null,
                            text: null
                        }));

                        citySelect.append($("<option>", {
                            value: null,
                            text: null
                        }));

                        data.states.forEach(function(state) {
                            stateSelect.append($("<option>", {
                                value: state.id,
                                text: state.name
                            }));
                        });


                    });
                });
            });

            $(document).ready(function() {
                $("#state-select").on("change", function() {

                    var citySelect = $("#city-select");

                    var stateId = $(this).val();
                    if (stateId == ''){
                        citySelect.empty();

                        citySelect.append($("<option>", {
                            value: null,
                            text: null
                        }));
                        return;
                    }
                    // Obtenha os dados de estados e cidades com base no país selecionado
                    $.get("/filter/get_cities", { state_id: stateId }, function(data) {
                        citySelect.empty();

                        citySelect.append($("<option>", {
                            value: null,
                            text: null
                        }));

                        data.cities.forEach(function(city) {
                            citySelect.append($("<option>", {
                                value: city.id,
                                text: city.name
                            }));
                        });


                    });
                });
            });

        </script>